import fs from 'node:fs'

import yaml from 'js-yaml'

import { type DataFile, iconStyles } from '../types.js'

interface IconMetadata {
  changes: string[]
  styles: Array<(typeof iconStyles)[number]>
}

const metadata: Record<string, IconMetadata> = yaml.load(
  fs.readFileSync(
    './node_modules/@fortawesome/fontawesome-free/metadata/icons.yml',
    'utf8'
  )
) as Record<string, IconMetadata>

const dataFiles: Record<(typeof iconStyles)[number], DataFile> = {
  brands: {},
  regular: {},
  solid: {}
}

for (const [iconName, iconData] of Object.entries(metadata)) {
  for (const iconStyle of iconStyles) {
    if (iconData.styles.includes(iconStyle)) {
      dataFiles[iconStyle][iconName] = { minVersion: iconData.changes[0] }
    }
  }
}

for (const iconStyle of iconStyles) {
  const outputPath = `./data/${iconStyle}Icons.ts`
  const fileContent = `// This file is auto-generated by build/build.ts. Do not edit directly.

export const ${iconStyle}Icons = ${JSON.stringify(
    dataFiles[iconStyle],
    undefined,
    2
  )} as const

export default ${iconStyle}Icons
`
  fs.writeFileSync(outputPath, fileContent, 'utf8')
}
